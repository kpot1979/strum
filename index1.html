<!DOCTYPE HTML>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=1200">
    <link rel="stylesheet" href="css/bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="css/style.css" type="text/css"/>
    <script type="text/javascript" src="data.js"></script>
    <meta name="description" content="Программа расчета тока короткого замыкания в сети 0,4 кВ по ГОСТ 28249-93">
    <meta name="author" content="Андрюхин Сергей">
    <title>Расчет тока короткого замыкания в сети 0,4 кВ</title>
    <script>
        var schemaObj = {
            elements: {},
            templates: {},
            resistance: {},
            resistanceStatus: {},
            kzId: {},
            calc: {},
            defaultVar: {
                unn: 0.4,
                uvn: 6.3,
                ikz: "",
                arcResistance: 5,
                complexCosPphi: 0.8
            }
        };

        var symbol = {
            energySystem: 'с',
            transformator: 'т',
            kabelVn: 'кб',
            kabelNn: 'кб',
            shinoprovod: 'ш',
            hookup: 'к',
            tt: 'TA',
            avtomat: 'кв',
            unique: ''
        }

        var energySystemTemplate = [
            new InitTemplateItem('input', 'energySystemUvn', 'form-control w1', schemaObj.defaultVar.uvn, null, '<i>U</i><sub>с.ВН</sub> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' кВ', null),
            new InitTemplateItem('input', 'energySystemUnn', 'form-control w1', schemaObj.defaultVar.unn, null, '<i>U</i><sub>с.НН</sub> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' кВ', null),
            new InitTemplateItem('input', 'energySystemIkz', 'form-control w1', schemaObj.defaultVar.ikz, null, '<i>I</i><sub>к.ВН</sub><sup>(3)</sup> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' кА', null),
        ];
        var transformatorTemplate = [
            new InitTemplateItem('select', 'transformator', 'form-control', null, null, '<i>Трансформатор</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'transformatorArray')
        ];
        var kabelVnTemplate = [
            new InitTemplateItem('select', 'kabelVn', 'form-control w2', null, null, '<i>Кабель</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'kabelArray'),
            new InitTemplateItem('input', 'kabelVnLength', 'form-control w1', '1', null, '<i>Длина</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' м', null),
            new InitTemplateItem('select', 'kabelVnQuantity', 'form-control', '1', null, '<i>Кол-во</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' шт.', 'quantityArray')
        ];
        var kabelNnTemplate = [
            new InitTemplateItem('select', 'kabelNn', 'form-control w2', null, null, '<i>Кабель</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'kabelArray'),
            new InitTemplateItem('input', 'kabelNnLength', 'form-control w1', '1', null, '<i>Длина</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' м', null),
            new InitTemplateItem('select', 'kabelNnQuantity', 'form-control', '1', null, '<i>Кол-во</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' шт.', 'quantityArray')
        ];
        var shinoprovodTemplate = [
            new InitTemplateItem('select', 'shinoprovod', 'form-control w2', null, null, '<i>Шинопровод</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'shinoprovodArray'),
            new InitTemplateItem('input', 'shinoprovodLength', 'form-control w1', '1', null, '<i>Длина</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' м', null)
        ];
        var hookupTemplate = [
            new InitTemplateItem('select', 'hookup', 'form-control w2', null, null, '<i>Контактные соединения</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'hookupArray'),
            new InitTemplateItem('input', 'hookupQuantity', 'form-control w1', '1', null, '<i>Кол-во</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' шт.', null)
        ];
        var ttTemplate = [
            new InitTemplateItem('select', 'tt', 'form-control w2', null, null, '<i>Трансформатор тока</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'ttArray'),
            new InitTemplateItem('input', 'ttQuantity', 'form-control w1', '1', null, '<i>Кол-во</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' шт.', null)
        ];
        var avtomatTemplate = [
            new InitTemplateItem('select', 'avtomat', 'form-control w2', null, null, '<i>Автомат </i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', 'avtomatArray'),
            new InitTemplateItem('input', 'avtomatQuantity', 'form-control w1', '1', null, '<i>Кол-во</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' шт.', null)
        ];
        var uniqueTemplate = [
            new InitTemplateItem('input', 'uniqueR', 'form-control w1', '', null, '<i>R</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' мОм', null),
            new InitTemplateItem('input', 'uniqueX', 'form-control w1', '', null, '<i>X</i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' мОм', null),
            new InitTemplateItem('input', 'uniqueR0', 'form-control w1', '', null, '<i>R</i><sub>0</sub> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' мОм', null),
            new InitTemplateItem('input', 'uniqueX0', 'form-control w1', '', null, '<i>X</i><sub>0</sub> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', ' мОм', null),
        ];

        var complexTemplate = [
            new InitTemplateItem('select', 'complexSelector', 'form-control w2', null, null, '<i>Состав потребителей </i> =&nbsp;', 'changeElementComplex', '<div class=\"form-group\">', '</div>', '', 'complexArray'),
            new InitTemplateItem('input', 'complexCosF', 'form-control w1', schemaObj.defaultVar.complexCosPphi, null, '<i>cos&phi; </i> =&nbsp;', 'changeElementValue', '<div class=\"form-group\">', '</div>', '', null),
        ];

        var energySystemResistance = {r: null, x: null, r0: null, x0: null};
        var transformatorResistance = {r: null, x: null, r0: null, x0: null};
        var kabelVnResistance = {r: null, x: null, r0: null, x0: null};
        var kabelNnResistance = {r: null, x: null, r0: null, x0: null};
        var shinoprovodResistance = {r: null, x: null, r0: null, x0: null};
        var hookupResistance = {r: null, x: null, r0: null, x0: null};
        var ttResistance = {r: null, x: null, r0: null, x0: null};
        var avtomatResistance = {r: null, x: null, r0: null, x0: null};
        var uniqueResistance = {r: null, x: null, r0: null, x0: null};
        var complexResistance = {
            current: null,
            bazis: null,
            EngRel: null,
            Z1ngRel: null,
            Z2ngRel: null,
            Z0ngRel: null,
            Eng: null,
            Z1ng: null,
            Z2ng: null,
            Z0ng: null
        };

        var energySystemObj = new ElementsDataObj('energySystem', 'Энергосистема', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var transformatorObj = new ElementsDataObj('transformator', 'Трансформатор', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var kabelVnObj = new ElementsDataObj('kabelVn', 'Кабельная линия ВН', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var kabelNnObj = new ElementsDataObj('kabelNn', 'Кабельная линия НН', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var shinoprovodObj = new ElementsDataObj('shinoprovod', 'Шинопровод', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var hookupObj = new ElementsDataObj('hookup', 'Контактные соединения', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var ttObj = new ElementsDataObj('tt', 'Трансформатор тока', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var avtomatObj = new ElementsDataObj('avtomat', 'Автоматический выключатель', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var uniqueObj = new ElementsDataObj('unique', 'Свой элемент', null, null, null, '<div class=\"form-inline\">{tpl}</div>', null, null);
        var complexObj = new ElementsDataObj('complex', 'Комплексная нагрузка', null, null, null, '<div class=\"form-inline\">{tpl}</div>', 2, 'complex-data');


        var elementObj = {
            energySystem: energySystemObj,
            transformator: transformatorObj,
            kabelVn: kabelVnObj,
            kabelNn: kabelNnObj,
            shinoprovod: shinoprovodObj,
            hookup: hookupObj,
            tt: ttObj,
            avtomat: avtomatObj,
            unique: uniqueObj,
            complex: complexObj,
        };

        var templateObj = {
            energySystem: energySystemTemplate,
            transformator: transformatorTemplate,
            kabelVn: kabelVnTemplate,
            kabelNn: kabelNnTemplate,
            shinoprovod: shinoprovodTemplate,
            hookup: hookupTemplate,
            tt: ttTemplate,
            avtomat: avtomatTemplate,
            unique: uniqueTemplate,
            complex: complexTemplate,
        };

        var resistanceObj = {
            energySystem: energySystemResistance,
            transformator: transformatorResistance,
            kabelVn: kabelVnResistance,
            kabelNn: kabelNnResistance,
            shinoprovod: shinoprovodResistance,
            hookup: hookupResistance,
            tt: ttResistance,
            avtomat: avtomatResistance,
            unique: uniqueResistance,
            complex: complexResistance,
        };

        var textSelectEl = '<p class=\"text-danger\">Выберите элемент сети!</p>';
        var textAddEl = '<p class=\"text-danger\">Добавьте элемент сети!</p>';
        var textAddPointKz = '<p class=\"text-danger\">Укажите точку КЗ!</p>';
        var textAddData = '<p class=\"text-danger\">Введите даные!</p>';
        var textLocalError = '<p class=\"text-danger\">Ошибка при обращении к локальному хранилищу</p>';
        var textDontHaveSavProject = '<p class=\"text-danger\">У Вас нет сохраненных проектов!</p>';
        var textProjectSaved = '<p class=\"text-success\">Спасибо, ваш проект сохранен!</p>';
        var textProjectSendSaved = '<p class=\"text-success\">Спасибо, ваш проект сохранен в файл. Если он не загрузился автоматически, то нажмите кнопку \"Сохранить\" в диалоговом окне.</p>';
        var textSaveFileError = '<p class=\"text-danger\">Ошибка при сохранении проекта в файл!</p>';
        var textLastEl = '<p class=\"text-danger\">Элемент \"{var}\" должен быть последним в схеме!</p>';
        var textCosPphi = '<p class=\"text-danger\">Введите значение cos&phi;!</p>';
        var textResistanceIsNotDefined = '<p class=\"text-danger\">На участках {var} не определены сопротивления!</p>';

        window.onload = function () {
            var elementSelect = document.getElementById("elementSelect");
            var arcSelectVar = document.getElementById("arcSelect");
            var arcInputVar = document.getElementById("arcInput");
            elementSelect.innerHTML = addElementsSelect();
            arcSelectVar.innerHTML = addOption(arcArray, schemaObj.defaultVar.arcResistance);
            arcInputVar.value = schemaObj.defaultVar.arcResistance;

            arcSelectVar.addEventListener("change", function () {
                schemaObj.defaultVar.arcResistance = arcSelectVar.value;
                arcInputVar.value = schemaObj.defaultVar.arcResistance;
            });

            arcInputVar.addEventListener("change", function () {
                schemaObj.defaultVar.arcResistance = convertingData(arcInputVar.value);
                arcSelectVar.innerHTML = addOption(arcArray, schemaObj.defaultVar.arcResistance);
            });
        }

        function ElementsDataObj(key, name, title, rowId, pointKz, tplWrp, divider, dividerInsId) {
            this.key = key;
            this.name = name;
            this.title = title;
            this.rowId = rowId;
            this.pointKz = pointKz;
            this.tplWrp = htmlEncode(tplWrp);
            this.divider = divider;
            this.dividerInsId = dividerInsId;
        }

        function InitTemplateItem(typeItem, idItem, classItem, valueItem, textItem, labelItem, functionItem, wrapperItemStart, wrapperItemEnd, suffixItem, outerData) {
            this.typeItem = typeItem;
            this.idItem = idItem;
            this.classItem = classItem;
            this.valueItem = valueItem;
            this.textItem = textItem;
            this.labelItem = htmlEncode(labelItem);
            this.functionItem = functionItem;
            this.wrapperItemStart = htmlEncode(wrapperItemStart);
            this.wrapperItemEnd = htmlEncode(wrapperItemEnd);
            this.suffixItem = suffixItem;
            this.outerData = outerData;
        }

        function addElementsSelect() {
            let html = '<option value=\"\">--- Выбор элемента сети ---</option>';
            for (let key in elementObj) {
                html += '<option value=' + key + '>' + elementObj[key].name + '</option>';
            }
            return html;
        }

        function addOption(arrayStr, value) {
            let array = eval(arrayStr);
            let html = '';
            let arraySplit;
            for (let i = 0; i < array.length; i++) {
                let selected = '';
                let arraySplit = array[i].split('|');
                let text = arraySplit.pop();
                let val = arraySplit.join('|');
                if (value == val) {
                    selected = 'selected';
                }
                html += '<option value=\"' + val + '\" ' + selected + '>' + text + '</option>';
            }
            return html;
        }

        function prepareTemplate(data) {
            let obj = [];
            for (let i = 0; i < data.length; i++) {
                obj[i] = iterationCopy(data[i]);
            }
            return obj;
        }

        function renderTemplateItemData(element, rowId, insert) {
            if (insert === undefined) {
                insert = false;
            }
            let template = prepareTemplate(templateObj[element]);
            if (insert === true) {
                template = prepareTemplate(schemaObj.templates[rowId]);
            }
            let html = '';
            let tplWrp = schemaObj.elements[rowId].tplWrp;
            let divider = schemaObj.elements[rowId].divider;
            let dividerInsId = schemaObj.elements[rowId].dividerInsId;
            if (tplWrp !== null) {
                tplWrp = tplWrp.split('{tpl}');
            } else {
                tplWrp = ['', '']
            }            
            html += htmlDecode(tplWrp[0]);
            for (let i = 0; i < template.length; i++) {
                if (i == divider) {
                    html += htmlDecode(tplWrp[1]);
                    if (dividerInsId != null) {
                        html += htmlDecode(tplWrp[0].replace('&gt;', 'id=\"'+dividerInsId+'\"&gt;'));
                    }else {
                        html += htmlDecode(tplWrp[0]);
                    }
                }
                let functionItem = '';
                if (template[i].functionItem !== null) {
                    functionItem = 'onchange=\"' + template[i].functionItem + '(this.id, ' + rowId + ')\"';
                }
                let valueItem = template[i].valueItem;
                if (template[i].valueItem === null) {
                    valueItem = '';
                }
                if (template[i].typeItem == "input") {
                    html += htmlDecode(template[i].wrapperItemStart);
                    html += '<label for=\"' + template[i].idItem + rowId + '\">' + htmlDecode(template[i].labelItem) + '</label>';
                    html += '<input id=\"' + template[i].idItem + rowId + '\" ' + functionItem + ' class=\"' + template[i].classItem + '\" type=\"text\" name=\"' + template[i].idItem + '[' + rowId + ']\" value=\"' + valueItem + '\" data-templateArrayKey=\"' + [i] + '\">' + template[i].suffixItem;
                    html += htmlDecode(template[i].wrapperItemEnd);
                } else if (template[i].typeItem == "select") {
                    html += htmlDecode(template[i].wrapperItemStart);
                    html += '<label for=\"' + template[i].idItem + rowId + '\">' + htmlDecode(template[i].labelItem) + '</label>';
                    html += '<select id=\"' + template[i].idItem + rowId + '\" ' + functionItem + ' class=\"' + template[i].classItem + '\" name=\"' + template[i].idItem + '[' + rowId + ']\" data-templateArrayKey=\"' + [i] + '\">';
                    html += addOption(template[i].outerData, template[i].valueItem);
                    html += '</select>' + template[i].suffixItem;
                    html += htmlDecode(template[i].wrapperItemEnd);
                }
            }
            html += htmlDecode(tplWrp[1]);
            if (dividerInsId != null && template.length <= divider) {
                html += '<div id=\"'+dividerInsId+'\" class=\"form-inline\"></div>';
            }
            return html;
        }

        function renderItemScheme(element, rowId, insert) {
            if (insert === undefined) {
                insert = null;
            }
            let img;
            let resistanceData = '';
            if (element == 'energySystem') {
                img = systemSvg;
            } else if (element == 'transformator') {
                img = transformatorSvg;
            } else if (element == 'kabelVn' || element == 'kabelNn') {
                img = klSvg;
            } else if (element == 'shinoprovod') {
                img = klSvg;
            } else if (element == 'hookup') {
                img = hookupSvg;
            } else if (element == 'tt') {
                img = ttSvg;
            } else if (element == 'avtomat') {
                img = avtomatSvg;
            } else {
                img = klSvg;
            }
            if (insert !== null) {
                resistanceData = insert;
            }
            let pointKz = '';
            let pointKzImg = '';
            if (schemaObj.elements[rowId].pointKz !== null) {
                pointKz = ' pointKz';
                pointKzImg = '<span>К' + rowId + '</span> ' + pointKzSvg;
            }
            let html = '';
            html += '<div id=\"' + element + 'Img' + rowId + '\" class=\"' + element + 'Img' + pointKz + '\">';
            html += '   <div id=\"' + element + 'Resistance' + rowId + '\" class=\"resistanceData\">' + resistanceData + '</div>';
            html += '   <div id=\"pointKzWrapper' + rowId + '\" class=\"pointKzWrapper\">' + pointKzImg + '</div>';
            html += img;
            html += '</div>';
            return html;
        }

        function renderItemPointKz(element, rowId, pointKz) {
            if (pointKz === undefined) {
                pointKz = null;
            }
            let html = '';
            let checked = '';
            if (pointKz !== null) {
                checked = 'checked';
            }
            html += '<input id=\"' + element + 'Checkbox' + rowId + '\" type=\"checkbox\" onchange=\"changeCheckbox(this.id, ' + rowId + ')\" name=\"' + element + 'Checkbox[' + rowId + ']\" ' + checked + '>';
            return html;
        }

        function lastElementObj(obj) {
            let lastElement;
            for (var key in obj) {
                lastElement = obj[key];
            }
            return lastElement;
        }

        function deleteRow(rowId) {
            document.getElementById("row" + rowId + "").outerHTML = "";
            delete schemaObj.elements[rowId];
            delete schemaObj.templates[rowId];
            delete schemaObj.resistance[rowId];
            delete schemaObj.resistanceStatus[rowId];
            delete schemaObj.kzId[rowId];
            delete schemaObj.calc[rowId];
            //console.log(schemaObj);
        }

        function addRow() {
            let elementSelect = document.getElementById("elementSelect").value;
            if (elementSelect != '') {
                let lastElement = lastElementObj(schemaObj.elements);
                if (lastElement && lastElement.key == 'complex') {
                    console.log(schemaObj);
                    customModal(textLastEl, lastElement.name);
                } else {
                    let html = "";
                    let table = document.getElementById("tableKz");
                    let rowId = (table.rows.length) - 1;
                    elementObj[elementSelect].rowId = rowId;
                    schemaObj.elements[rowId] = iterationCopy(elementObj[elementSelect]);
                    schemaObj.templates[rowId] = prepareTemplate(templateObj[elementSelect]);
                    schemaObj.resistance[rowId] = iterationCopy(resistanceObj[elementSelect]);
                    schemaObj.resistanceStatus[rowId] = false;
                    html += "<tr id='row" + rowId + "'>";
                    html += "   <td id='elementSelect" + rowId + "'>";
                    html += "       <div class='form-inline'>";
                    html += "           <div class='form-group'><label>" + rowId + "</label>&nbsp;";
                    html += "               <input id='elementSelectVal" + rowId + "' class='form-control select' type='text' name='elementSelectVal[" + rowId + "]' onchange='changeElementTitleValue(this.id," + rowId + ")' value='" + elementObj[elementSelect].name + "'>";
                    html += "           </div>";
                    html += "       </div>";
                    html += "   </td>";
                    html += "   <td id='elementScheme" + rowId + "' class='elementScheme'>" + renderItemScheme(elementSelect, rowId) + "</td>";
                    html += "   <td id='elementData" + rowId + "' class='elementData'>" + renderTemplateItemData(elementSelect, rowId) + "</td>";
                    html += "   <td id='pointKz" + rowId + "' class='elementPointKz'>" + renderItemPointKz(elementSelect, rowId) + "</td>";
                    html += "   <td><input type='button' value='Удалить' class='delete btn btn-danger' onclick='deleteRow(" + rowId + ")'></td>";
                    html += "</tr>";
                    let row = table.insertRow(rowId).outerHTML = html;
                }
            } else {
                customModal(textSelectEl);
            }
        }

        function changeElementValue(elementId, rowId) {
            let element = document.getElementById(elementId);
            let elementValue = element.value;
            let templateArrayKey = element.getAttribute('data-templateArrayKey');
            let elementText = null;
            let data;
            if (schemaObj.templates[rowId][templateArrayKey].typeItem == "select") {
                elementText = element.options[element.selectedIndex].text;
                if (elementValue == '' || elementValue === null) {
                    elementValue = null;
                }
                schemaObj.templates[rowId][templateArrayKey].valueItem = elementValue;
            } else {
                data = convertingData(elementValue);
                if (data == '' || data == 0 || data === null) {
                    data = null;
                }
                schemaObj.templates[rowId][templateArrayKey].valueItem = data;
                element.value = data;
                element.setAttribute('value', data);
            }
            schemaObj.templates[rowId][templateArrayKey].textItem = elementText;
            calcResistance(rowId);
            addResistance(rowId);
            //console.log(schemaObj);
        }

        function changeElementTitleValue(elementId, rowId) {
            let element = document.getElementById(elementId);
            let elementValue = element.value;
            schemaObj.elements[rowId].title = elementValue.replace(/[\\\|\'\"\#^\:\;\\$\%\&\?\/]/g, '');
        }

        function changeCheckbox(elementId, rowId) {
            let checkbox = document.getElementById(elementId);
            let img = document.getElementById(elementId.replace('Checkbox', 'Img'));
            let pointKzWrapper = document.getElementById("pointKzWrapper" + rowId);
            if (checkbox.checked) {
                schemaObj.kzId[rowId] = elementId;
                schemaObj.elements[rowId].pointKz = rowId;
                img.classList.add('pointKz');
                pointKzWrapper.innerHTML = '<span>К' + rowId + '</span> ' + pointKzSvg;
            } else {
                delete schemaObj.kzId[rowId];
                schemaObj.elements[rowId].pointKz = null;
                img.classList.remove('pointKz');
                pointKzWrapper.innerHTML = '';
            }
        }

        function calcResistance(rowId) {
            let element = schemaObj.elements[rowId];
            let template = schemaObj.templates[rowId];
            let resistance;
            if (element.key == 'energySystem') {
                resistance = calcResistanceEnergySystem(rowId, template);
            } else if (element.key == 'transformator') {
                resistance = calcResistanceTransformator(rowId, template);
            } else if (element.key == 'kabelVn' || element.key == 'kabelNn') {
                resistance = calcResistanceKabel(rowId, template, element.key);
            } else if (element.key == 'shinoprovod') {
                resistance = calcResistanceShinoprovod(rowId, template);
            } else if (element.key == 'hookup') {
                resistance = calcResistanceHookup(rowId, template);
            } else if (element.key == 'tt' || element.key == 'avtomat') {
                resistance = calcResistanceTt(rowId, template);
            } else if (element.key == 'unique') {
                resistance = calcResistanceUnique(rowId, template);
            } else if (element.key == 'complex') {
                resistance = calcResistanceComplex(rowId, template);
            }
            if (element.key != 'complex') {
                schemaObj.resistance[rowId].r = resistance[0]; //r
                schemaObj.resistance[rowId].x = resistance[1];  //x
                schemaObj.resistance[rowId].r0 = resistance[2]; //r0
                schemaObj.resistance[rowId].x0 = resistance[3]; //x0
                schemaObj.resistanceStatus[rowId] = true;
            }
        }

        function calcResistanceEnergySystem(rowId, template) {
            let uvn = template[0].valueItem;
            let unn = template[1].valueItem;
            let ikz = template[2].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (uvn !== null && unn !== null && ikz !== null) {
                schemaObj.defaultVar.uvn = uvn;
                schemaObj.defaultVar.unn = unn;
                schemaObj.defaultVar.ikz = ikz;
                let xcvn = uvn / (Math.sqrt(3) * ikz);
                r = 0;
                x = 1000 * xcvn * Math.pow((unn / uvn), 2);
                r0 = 0;
                x0 = 0;
            }
            return [r, x, r0, x0];
        }

        function calcResistanceTransformator(rowId, template) {
            let val = template[0].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (val !== null) {
                let value = val.split('|');
                r = value[0] * 1;
                x = value[1] * 1;
                r0 = value[2] * 1;
                x0 = value[3] * 1;
            }
            return [r, x, r0, x0];
        }

        function calcResistanceKabel(rowId, template, elementKey) {
            let val = template[0].valueItem;
            let length = template[1].valueItem;
            let quantity = template[2].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (val !== null) {
                let value = val.split('|');
                let kabelResist = [];
                let vnToNn = 1;
                if (elementKey == 'kabelVn') {
                    vnToNn = (Math.pow(schemaObj.defaultVar.unn, 2) / (Math.pow(schemaObj.defaultVar.uvn, 2)));
                }
                for (let i = 0; i < value.length; i++) {
                    kabelResist[i] = ((value[i] * length) / quantity) * vnToNn;
                }
                r = kabelResist[0];
                x = kabelResist[1];
                r0 = kabelResist[2];
                x0 = kabelResist[3];
            }
            return [r, x, r0, x0];
        }

        function calcResistanceShinoprovod(rowId, template) {
            let val = template[0].valueItem;
            let length = template[1].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (val !== null) {
                let value = val.split('|');
                r = value[0] * length;
                x = value[1] * length;
                r0 = (value[0] * length) + (3 * value[2] * length);
                x0 = (value[1] * length) + (3 * value[3] * length);
            }
            return [r, x, r0, x0];
        }

        function calcResistanceHookup(rowId, template) {
            let val = template[0].valueItem;
            let quantity = template[1].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (val !== null) {
                let value = val.split('|');
                r = value[0] * quantity;
                x = 0;
                r0 = value[2] * quantity;
                x0 = 0;
            }
            return [r, x, r0, x0];
        }

        function calcResistanceTt(rowId, template) {
            let val = template[0].valueItem;
            let quantity = template[1].valueItem;
            let r = null, x = null, r0 = null, x0 = null;
            if (val !== null) {
                let value = val.split('|');
                r = value[0] * quantity;
                x = value[1] * quantity;
                r0 = value[2] * quantity;
                x0 = value[3] * quantity;
            }
            return [r, x, r0, x0];
        }

        function calcResistanceUnique(rowId, template) {
            let r = null, x = null, r0 = null, x0 = null;
            r = template[0].valueItem * 1;
            x = template[1].valueItem * 1;
            r0 = template[2].valueItem * 1;
            x0 = template[3].valueItem * 1;
            return [r, x, r0, x0];
        }

        function calcResistanceComplex(rowId, template) {
            let element = template[0].valueItem;
            let cosF = template[1].valueItem;
            let power = [];
            let powerVal = [];

            for (let i = 2; i < template.length; i++) {
                let type = template[i].idItem.split('_');
                let status = true;
                if (template[i].valueItem == '' || template[i].valueItem == null) {
                    status = false
                }
                power.push({
                    type: type[0],
                    value: template[i].valueItem,
                    id: template[i].idItem,
                    valueStatus: status
                });
                powerVal.push(template[i].valueItem);
            }
            if (isValueInObj(power, false, 'valueStatus') == true) {
                let powerSum = powerVal.reduce(function (sum, current) {
                    return +sum + +current;
                }, 0);

                let resPower = power.map(function (item) {
                    let resPower = item.value / powerSum;
                    let data = eval(element);
                    let Eng = data.Eng[item.type];
                    let Z1ng = data.Z1ng[item.type];
                    let Z2ng = data.Z2ng[item.type];
                    let Z0ng = data.Z0ng[item.type];
                    let result = [resPower, Eng, Z1ng, Z2ng, Z0ng];
                    return result;
                });

                let koef = [];
                for (let j = 0; j < resPower.length; j++) {
                    koef.push([getKoef(resPower[j][0], resPower[j][1]), getKoef(resPower[j][0], resPower[j][2]), getKoef(resPower[j][0], resPower[j][3]), getKoef(resPower[j][0], resPower[j][4])]);
                }

                let resist = {};
                let Eng = 0;
                let Z1ng = 0;
                let Z2ng = 0;
                let Z0ng = 0;
                if (cosF == 0) {
                    customModal(textCosPphi);
                } else {
                    let cur = powerSum / (Math.sqrt(3) * cosF * schemaObj.defaultVar.unn)
                    let bazis = (380 * 1000) / (Math.sqrt(3) * cur);
                    for (var j = 0; j < resPower.length; j++) {
                        Eng += getKoef(resPower[j][0], resPower[j][1]);
                        Z1ng += getKoef(resPower[j][0], resPower[j][2]);
                        Z2ng += getKoef(resPower[j][0], resPower[j][3]);
                        Z0ng += getKoef(resPower[j][0], resPower[j][4]);
                    }
                    resist = {
                        Eng: 380 * Eng / j,
                        Z1ng: bazis * Z1ng / j,
                        Z2ng: bazis * Z2ng / j,
                        Z0ng: bazis * Z0ng / j
                    }
                    schemaObj.resistance[rowId].current = cur;
                    schemaObj.resistance[rowId].bazis = bazis;
                    schemaObj.resistance[rowId].EngRel = Eng / j;
                    schemaObj.resistance[rowId].Z1ngRel = Z1ng / j;
                    schemaObj.resistance[rowId].Z2ngRel = Z2ng / j;
                    schemaObj.resistance[rowId].Z0ngRel = Z0ng / j;
                    schemaObj.resistance[rowId].Eng = resist.Eng;
                    schemaObj.resistance[rowId].Z1ng = resist.Z1ng;
                    schemaObj.resistance[rowId].Z2ng = resist.Z2ng;
                    schemaObj.resistance[rowId].Z0ng = resist.Z0ng;
                    schemaObj.resistanceStatus[rowId] = true;
                }
            }
        }

        function getKoef(power, obj) {
            let result;
            if (typeof obj == "object") {
                for (let key in obj) {
                    result = obj[key];
                    key = +key;
                    if (key > power) {
                        break;
                    }
                }
            } else {
                result = 0
            }
            return result;
        }

        function isValueInObj(obj, value, property) {
            let result = false;
            for (let key in obj) {
                let element = obj[key];
                if (property != undefined) {
                    element = obj[key][property];
                }
                if (element == value) {
                    return result = false;
                } else {
                    result = true;
                }
            }
            return result;
        }

        function addResistance(rowId, insert) {
            if (insert === undefined) {
                insert = false;
            }
            let html = '<span>';
            if (schemaObj.elements[rowId].key == 'complex') {
                if (schemaObj.resistanceStatus[rowId] != false) {
                    if (schemaObj.resistance[rowId].Z1ng !== 0 && schemaObj.resistance[rowId].Z1ng !== null) {
                        html += 'E&Prime;<sub>нг</sub>=' + customRound(schemaObj.resistance[rowId].Eng, 1) + ' В<br>';
                        html += 'Z<sub>1нг</sub>=' + customRound(schemaObj.resistance[rowId].Z1ng, 1) + ' мОм<br>';
                        html += 'Z<sub>2нг</sub>=' + customRound(schemaObj.resistance[rowId].Z2ng, 1) + ' мОм<br>';
                        html += 'Z<sub>0нг</sub>=' + customRound(schemaObj.resistance[rowId].Z0ng, 1) + ' мОм<br>';
                    }
                }
            } else {
                if (schemaObj.resistanceStatus[rowId] != false) {
                    if (schemaObj.resistance[rowId].r !== 0 && schemaObj.resistance[rowId].r !== null) {
                        html += 'R<sub>' + symbol[schemaObj.elements[rowId].key] + '</sub>=' + customRound(schemaObj.resistance[rowId].r) + ' мОм<br>';
                    }
                    if (schemaObj.resistance[rowId].x !== 0 && schemaObj.resistance[rowId].x !== null) {
                        html += 'X<sub>' + symbol[schemaObj.elements[rowId].key] + '</sub>=' + customRound(schemaObj.resistance[rowId].x) + ' мОм<br>';
                    }
                    if (schemaObj.resistance[rowId].r0 !== 0 && schemaObj.resistance[rowId].r0 !== null) {
                        html += 'R<sub>0' + symbol[schemaObj.elements[rowId].key] + '</sub>=' + customRound(schemaObj.resistance[rowId].r0) + ' мОм<br>';
                    }
                    if (schemaObj.resistance[rowId].x0 !== 0 && schemaObj.resistance[rowId].x0 !== null) {
                        html += 'X<sub>0' + symbol[schemaObj.elements[rowId].key] + '</sub>=' + customRound(schemaObj.resistance[rowId].x0) + ' мОм';
                    }
                }
            }
            html += '</span>';
            if (insert === false) {
                let id = document.getElementById(schemaObj.elements[rowId].key + 'Resistance' + rowId);
                id.innerHTML = html;
            } else {
                return html;
            }
        }

        function convertingData(data) {
            let result = data.replace(',', '.');
            result = result.replace(/[^0-9.]?/g, '');
            result = result.replace(/^([^\.]*\.)|\./g, '$1');
            return result;
        }

        function isEmptyObject(obj) { //0-если пустой
            let counter = 0;
            for (let key in obj) {
                counter++;
            }
            return counter;
        }

        function customModal(text, variable) {
            text = text.replace('{var}', variable);
            let modal = document.getElementById('modal');
            modal.style.display = 'none';
            let span = document.getElementById('modal-close');
            let content = document.getElementById('modal-content');
            let body = document.getElementById('modal-body');
            modal.style.display = 'block';
            modal.classList.add('in');
            body.innerHTML = text;
            span.onclick = function () {
                modal.classList.remove('in');
                modal.style.display = 'none';
            }
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                    modal.classList.remove('in');
                }
            }
        }

        function tokKz() {
            let countPointKz = isEmptyObject(schemaObj.kzId);
            let x = 0;
            let r = 0;
            let error = [];
            if (isEmptyObject(schemaObj.resistance) === 0) {
                customModal(textAddEl);
            } else {
                if (countPointKz == 0) {
                    customModal(textAddPointKz);
                } else {
                    let calc = {};
                    for (let kzIdkey in schemaObj.kzId) {
                        let result = {};
                        result.r = 0;
                        result.x = 0;
                        result.r0 = 0;
                        result.x0 = 0;
                        result.ik3max = 0;
                        result.ik3min = 0;
                        result.ik2 = 0;
                        result.ik1 = 0;
                        for (let rowId in schemaObj.resistance) {
                            result.r += schemaObj.resistance[rowId].r;
                            result.x += schemaObj.resistance[rowId].x;
                            result.r0 += schemaObj.resistance[rowId].r0;
                            result.x0 += schemaObj.resistance[rowId].x0;
                            if (schemaObj.resistance[rowId].r === null || schemaObj.resistance[rowId].x === null || !isFinite(schemaObj.resistance[rowId].r) || !isFinite(schemaObj.resistance[rowId].x) || (schemaObj.resistance[rowId].r == 0 && schemaObj.resistance[rowId].x == 0 && schemaObj.resistance[rowId].r0 == 0 && schemaObj.resistance[rowId].x0 == 0)) {
                                error.push(rowId);
                            }
                            if (kzIdkey == rowId) break;
                        }
                        let arcResistance = schemaObj.defaultVar.arcResistance * 1;
                        result.ik3max = (schemaObj.defaultVar.unn * 1000) / (Math.sqrt(3) * Math.sqrt(Math.pow(result.x, 2) + Math.pow(result.r, 2)));
                        result.ik3min = (schemaObj.defaultVar.unn * 1000) / (Math.sqrt(3) * Math.sqrt(Math.pow(result.x, 2) + Math.pow(result.r + arcResistance, 2)));
                        result.iudmax = Math.sqrt(2) * result.ik3max * koefUd(result.r, result.x);
                        result.iudmin = Math.sqrt(2) * result.ik3min * koefUd(result.r + arcResistance, result.x);
                        result.ia0max = Math.sqrt(2) * result.ik3max;
                        result.ia0min = Math.sqrt(2) * result.ik3min;
                        result.ik2max = (schemaObj.defaultVar.unn * 1000) / (2 * Math.sqrt(Math.pow(result.x, 2) + Math.pow(result.r, 2)));
                        result.ik2min = (schemaObj.defaultVar.unn * 1000) / (2 * Math.sqrt(Math.pow(result.x, 2) + Math.pow(result.r + arcResistance / 2, 2)));
                        result.ik1max = (schemaObj.defaultVar.unn * 1000 * Math.sqrt(3)) / Math.sqrt(Math.pow((2 * result.x) + result.x0, 2) + Math.pow((2 * (result.r)) + (result.r0), 2));
                        result.ik1min = (schemaObj.defaultVar.unn * 1000 * Math.sqrt(3)) / Math.sqrt(Math.pow((2 * result.x) + result.x0, 2) + Math.pow((2 * (result.r + arcResistance)) + (result.r0 + arcResistance), 2));
                        calc[kzIdkey] = result;
                    }
                    schemaObj.calc = calc;
                    // console.log(error);
                    // console.log(schemaObj);
                    reportTokKz(error);
                }
            }
        }

        function reportTokKz(error) {
            let calc = schemaObj.calc;
            let string = "";
            if (typeof calc === 'undefined' || isEmptyObject(calc) === 0) {
                customModal(textAddData);
            } else {
                if (error.length > 0) {
                    customModal(textResistanceIsNotDefined, error.join(', '));
                } else {
                    string += "<h3>Результаты расчета токов КЗ</h3>";
                    string += "<table class=\"table table-bordered text-center\">";
                    string += "<thead class=\"text-center\"><tr>";
                    string += "<th rowspan='2'>Точка КЗ</th>";
                    string += "<th rowspan='2'>Вид КЗ</th>";
                    string += "<th colspan='3'>Максимальное значение тока КЗ, кА</th>";
                    string += "<th colspan='3'>Минимальное значение тока КЗ, кА</th>";
                    string += "</tr><tr>";
                    string += "<th><abbr title='Действующее значение периодической составляющей тока КЗ'>I<sub>к.max</sub></abbr></th>";
                    string += "<th><abbr title='Наибольшее начальное значение апериодической составляющей тока КЗ'>i<sub>a0.max</sub></abbr></th>";
                    string += "<th><abbr title='Ударный ток КЗ'>i<sub>уд.max</sub></abbr></th>";
                    string += "<th><abbr title='Действующее значение периодической составляющей тока КЗ'>I<sub>к.min</sub></abbr></th>";
                    string += "<th><abbr title='Наибольшее начальное значение апериодической составляющей тока КЗ'>i<sub>a0.min</sub></abbr></th>";
                    string += "<th><abbr title='Ударный ток КЗ'>i<sub>уд.min</sub></abbr></th>";
                    string += "</tr></thead><tbody>";
                    for (let pointKz in calc) {
                        string += "<tr>";
                        string += "<td rowspan='3'>Участок " + pointKz + "<br>Точка К" + pointKz + "</td>";
                        string += "<td>К<sup>(3)</sup></td>";
                        string += "<td>" + customRound(calc[pointKz].ik3max) + "</td>";
                        string += "<td>" + customRound(calc[pointKz].ia0max) + "</td>";
                        string += "<td>" + customRound(calc[pointKz].iudmax) + "</td>";
                        string += "<td>" + customRound(calc[pointKz].ik3min) + "</td>";
                        string += "<td>" + customRound(calc[pointKz].ia0min) + "</td>";
                        string += "<td>" + customRound(calc[pointKz].iudmin) + "</td>";
                        string += "</tr><tr>";
                        string += "<td>К<sup>(2)</sup></td>";
                        string += "<td>" + customRound(calc[pointKz].ik2max) + "</td>";
                        string += "<td>-</td>";
                        string += "<td>-</td>";
                        string += "<td>" + customRound(calc[pointKz].ik2min) + "</td>";
                        string += "<td>-</td>";
                        string += "<td>-</td>";
                        string += "</tr><tr>";
                        string += "<td>К<sup>(1)</sup></td>";
                        string += "<td>" + customRound(calc[pointKz].ik1max) + "</td>";
                        string += "<td>-</td>";
                        string += "<td>-</td>";
                        string += "<td>" + customRound(calc[pointKz].ik1min) + "</td>";
                        string += "<td>-</td>";
                        string += "<td>-</td>";
                        string += "</tr>";
                    }
                    string += "</tbody></table>";
                    result(string);
                }
            } /////
        }

        function reportEnergySystem(rowId) {
            let string = '';
            let xcvn = schemaObj.defaultVar.uvn / (Math.sqrt(3) * schemaObj.defaultVar.ikz);
            string += '<div class="area">';
            string += '<h5><strong>Индуктивное сопротивление системы на участке ' + rowId + ':</strong></h5>';
            string += '<table style="min-width: 330px;"><tr><td rowspan="2">X<sub>с.вн</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">U<sub>вн</sub></td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.uvn + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(xcvn) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; I<sub>к.вн</sub><sup>(3)</sup></td><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; ' + schemaObj.defaultVar.ikz + '</td></tr></table>';
            string += 'I<sub>к.вн</sub><sup>(3)</sup> - <i>действующее значение периодической составляющей тока при трехфазном КЗ у выводов обмотки высшего напряжения трансформатора, кА</i><br><br>';
            string += '<i>Индуктивное сопротивление системы приведенное к низкой стороне:</i><br>';
            string += '<table style="min-width: 450px;"><tr><td rowspan="2">X<sub>с</sub>&nbsp;=&nbsp;10<sup>3</sup> &times; X<sub>с.вн</sub> &times;&nbsp;</td><td style="text-align:center;">U<sub>нн</sub><sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;1000 &times; ' + customRound(xcvn) + ' &times;&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + '<sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(1000 * customRound(xcvn) * Math.pow((schemaObj.defaultVar.unn / schemaObj.defaultVar.uvn), 2)) + ' мОм.</td></tr><tr><td style="border-top: 1px solid #000;"> U<sub>вн</sub><sup>2</sup></td><td style="border-top: 1px solid #000;">' + schemaObj.defaultVar.uvn + '<sup>2</sup></td></tr></table>';
            string += '</div>';
            return string;
        }

        function reportTransformator(rowId, title) {
            let string = '';
            string += '<div class="area">';
            string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
            string += 'R<sub>т</sub> = ' + schemaObj.resistance[rowId].r + ' мОм;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            string += 'X<sub>т</sub> = ' + schemaObj.resistance[rowId].x + ' мОм;<br>';
            string += 'R<sub>0т</sub> = ' + schemaObj.resistance[rowId].r0 + ' мОм;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            string += 'X<sub>0т</sub> = ' + schemaObj.resistance[rowId].x0 + ' мОм.<br>';
            string += '</div>';
            return string;
        }

        function reportKabelVn(rowId, title) {
            let string = '';
            try {
                let kabVnVal = schemaObj.templates[rowId][0].valueItem;
                let kabVnLength = schemaObj.templates[rowId][1].valueItem;
                let kabVnQuantity = schemaObj.templates[rowId][2].valueItem;
                let kabVn = kabVnVal.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">R<sub>кб.вн</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">R<sub>кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabVn[0] + ' &times; ' + kabVnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[0] * kabVnLength / kabVnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabVnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">X<sub>кб.вн</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">X<sub>кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabVn[1] + ' &times; ' + kabVnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[1] * kabVnLength / kabVnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabVnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">R<sub>0кб.вн</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">R<sub>0кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabVn[2] + ' &times; ' + kabVnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[2] * kabVnLength / kabVnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabVnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">X<sub>0кб.вн</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">X<sub>0кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabVn[3] + ' &times; ' + kabVnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[3] * kabVnLength / kabVnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabVnQuantity + '</td></tr></table>';
                string += 'l - <i>длина кабеля, м</i>;<br>';
                string += 'n - <i>количество параллельных ниток кабелей, шт</i>;<br>';
                string += '<i>Сопротивления приведенные к низкой стороне:</i><br>';
                string += '<table style="min-width: 370px;"><tr><td rowspan="2">R<sub>кб</sub>&nbsp;=&nbsp;R<sub>кб.вн</sub> &times;&nbsp;</td><td style="text-align:center;">U<sub>нн</sub><sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[0] * kabVnLength / kabVnQuantity) + ' &times;&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + '<sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[0] * kabVnLength / kabVnQuantity * Math.pow((schemaObj.defaultVar.unn / schemaObj.defaultVar.uvn), 2)) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;"> U<sub>вн</sub><sup>2</sup></td><td style="border-top: 1px solid #000;">' + schemaObj.defaultVar.uvn + '<sup>2</sup></td></tr></table>';
                string += '<table style="min-width: 370px;"><tr><td rowspan="2">X<sub>кб</sub>&nbsp;=&nbsp;X<sub>кб.вн</sub> &times;&nbsp;</td><td style="text-align:center;">U<sub>нн</sub><sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[1] * kabVnLength / kabVnQuantity) + ' &times;&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + '<sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[1] * kabVnLength / kabVnQuantity * Math.pow((schemaObj.defaultVar.unn / schemaObj.defaultVar.uvn), 2)) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;"> U<sub>вн</sub><sup>2</sup></td><td style="border-top: 1px solid #000;">' + schemaObj.defaultVar.uvn + '<sup>2</sup></td></tr></table>';
                string += '<table style="min-width: 370px;"><tr><td rowspan="2">R<sub>0кб</sub>&nbsp;=&nbsp;R<sub>0кб.вн</sub> &times;&nbsp;</td><td style="text-align:center;">U<sub>нн</sub><sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[2] * kabVnLength / kabVnQuantity) + ' &times;&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + '<sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[2] * kabVnLength / kabVnQuantity * Math.pow((schemaObj.defaultVar.unn / schemaObj.defaultVar.uvn), 2)) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;"> U<sub>вн</sub><sup>2</sup></td><td style="border-top: 1px solid #000;">' + schemaObj.defaultVar.uvn + '<sup>2</sup></td></tr></table>';
                string += '<table style="min-width: 370px;"><tr><td rowspan="2">X<sub>0кб</sub>&nbsp;=&nbsp;X<sub>0кб.вн</sub> &times;&nbsp;</td><td style="text-align:center;">U<sub>нн</sub><sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[3] * kabVnLength / kabVnQuantity) + ' &times;&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + '<sup>2</sup></td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabVn[3] * kabVnLength / kabVnQuantity * Math.pow((schemaObj.defaultVar.unn / schemaObj.defaultVar.uvn), 2)) + ' мОм.</td></tr><tr><td style="border-top: 1px solid #000;"> U<sub>вн</sub><sup>2</sup></td><td style="border-top: 1px solid #000;">' + schemaObj.defaultVar.uvn + '<sup>2</sup></td></tr></table>';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportKabelNn(rowId, title) {
            let string = '';
            try {
                let kabNnVal = schemaObj.templates[rowId][0].valueItem;
                let kabNnLength = schemaObj.templates[rowId][1].valueItem;
                let kabNnQuantity = schemaObj.templates[rowId][2].valueItem;
                let kabNn = kabNnVal.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';

                string += '<table style="min-width: 330px;"><tr><td rowspan="2">R<sub>кб</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">R<sub>кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabNn[0] + ' &times; ' + kabNnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabNn[0] * kabNnLength / kabNnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabNnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">X<sub>кб</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">X<sub>кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabNn[1] + ' &times; ' + kabNnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabNn[1] * kabNnLength / kabNnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabNnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">R<sub>0кб</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">R<sub>0кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabNn[2] + ' &times; ' + kabNnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabNn[2] * kabNnLength / kabNnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabNnQuantity + '</td></tr></table>';
                string += '<table style="min-width: 330px;"><tr><td rowspan="2">X<sub>0кб</sub>&nbsp;=&nbsp;</td><td style="text-align:center;">X<sub>0кб</sub> &times; l</td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + kabNn[3] + ' &times; ' + kabNnLength + '</td><td rowspan="2">&nbsp;=&nbsp;' + customRound(kabNn[3] * kabNnLength / kabNnQuantity) + ' мОм;</td></tr><tr><td style="border-top: 1px solid #000;text-align:center;">n</td><td style="border-top: 1px solid #000;text-align:center;">' + kabNnQuantity + '</td></tr></table>';
                string += 'l - <i>длина кабеля, м</i>;<br>';
                string += 'n - <i>количество параллельных ниток кабелей, шт</i>.';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportShinoprovod(rowId, title) {
            let string = '';
            try {
                let shnpVal = schemaObj.templates[rowId][0].valueItem;
                let shnpLength = schemaObj.templates[rowId][1].valueItem;
                let shnp = shnpVal.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
                string += 'R<sub>ш</sub> = R<sub>ш</sub> &times; l = ' + shnp[0] + ' &times; ' + shnpLength + ' = ' + customRound(shnp[0] * shnpLength) + ' мОм;<br>';
                string += 'X<sub>ш</sub> = X<sub>ш</sub> &times; l = ' + shnp[1] + ' &times; ' + shnpLength + ' = ' + customRound(shnp[1] * shnpLength) + ' мОм;<br>';
                string += 'R<sub>0ш</sub> = (R<sub>ш</sub> + 3&times;R<sub>нп</sub>) &times; l =  (' + shnp[0] + ' + 3 &times; ' + shnp[2] + ') &times; ' + shnpLength + ' = ' + customRound(+(shnp[0] * shnpLength) + (3 * shnp[2] * shnpLength)) + ' мОм;<br>';
                string += 'X<sub>0ш</sub> = (X<sub>ш</sub> + 3&times;X<sub>нп</sub>) &times; l =  (' + shnp[1] + ' + 3 &times; ' + shnp[3] + ') &times; ' + shnpLength + ' = ' + customRound(+(shnp[1] * shnpLength) + (3 * shnp[3] * shnpLength)) + ' мОм;<br>';
                string += 'l - <i>длина шинопровода, м</i>;<br>';
                string += 'R<sub>нп</sub>, X<sub>нп</sub> - <i>сопротивления нулевого проводника, мОм</i>.';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportHookup(rowId, title) { //контакты
            let string = '';
            try {
                let hookup = schemaObj.templates[rowId][0].valueItem;
                let hookupQuantity = schemaObj.templates[rowId][1].valueItem;
                let hookupValue = hookup.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
                string += 'R<sub>к</sub> = R<sub>к</sub> &times; n = ' + hookupValue[0] + ' &times; ' + hookupQuantity + ' = ' + customRound(hookupValue[0] * hookupQuantity) + ' мОм;<br>';
                string += 'R<sub>0к</sub> = R<sub>0к</sub> &times; n = ' + hookupValue[2] + ' &times; ' + hookupQuantity + ' = ' + customRound(hookupValue[2] * hookupQuantity) + ' мОм;<br>';
                string += 'n - <i>количество, шт</i>.';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportTt(rowId, title) {
            let string = '';
            try {
                let tt = schemaObj.templates[rowId][0].valueItem;
                let ttQuantity = schemaObj.templates[rowId][1].valueItem;
                let ttValue = tt.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
                string += 'R<sub>TA</sub> = R<sub>TA</sub> &times; n = ' + ttValue[0] + ' &times; ' + ttQuantity + ' = ' + customRound(ttValue[0] * ttQuantity) + ' мОм;<br>';
                string += 'X<sub>TA</sub> = X<sub>TA</sub> &times; n = ' + ttValue[1] + ' &times; ' + ttQuantity + ' = ' + customRound(ttValue[1] * ttQuantity) + ' мОм;<br>';
                string += 'R<sub>0TA</sub> = R<sub>0TA</sub> &times; n = ' + ttValue[2] + ' &times; ' + ttQuantity + ' = ' + customRound(ttValue[2] * ttQuantity) + ' мОм;<br>';
                string += 'X<sub>0TA</sub> = X<sub>0TA</sub> &times; n = ' + ttValue[3] + ' &times; ' + ttQuantity + ' = ' + customRound(ttValue[3] * ttQuantity) + ' мОм;<br>';
                string += 'n - <i>количество, шт</i>.';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportAvtomat(rowId, title) {
            let string = '';
            try {
                let avtomat = schemaObj.templates[rowId][0].valueItem;
                let avtomatQuantity = schemaObj.templates[rowId][1].valueItem;
                let avtomatValue = avtomat.split('|');
                string += '<div class="area">';
                string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
                string += 'R<sub>кв</sub> = R<sub>кв</sub> &times; n = ' + avtomatValue[0] + ' &times; ' + avtomatQuantity + ' = ' + customRound(avtomatValue[0] * avtomatQuantity) + ' мОм;<br>';
                string += 'X<sub>кв</sub> = X<sub>кв</sub> &times; n = ' + avtomatValue[1] + ' &times; ' + avtomatQuantity + ' = ' + customRound(avtomatValue[1] * avtomatQuantity) + ' мОм;<br>';
                string += 'R<sub>0кв</sub> = R<sub>0кв</sub> &times; n = ' + avtomatValue[2] + ' &times; ' + avtomatQuantity + ' = ' + customRound(avtomatValue[2] * avtomatQuantity) + ' мОм;<br>';
                string += 'X<sub>0кв</sub> = X<sub>0кв</sub> &times; n = ' + avtomatValue[3] + ' &times; ' + avtomatQuantity + ' = ' + customRound(avtomatValue[3] * avtomatQuantity) + ' мОм;<br>';
                string += 'n - <i>количество, шт</i>.';
                string += '</div>';
                return string;
            } catch (err) {
            }
        }

        function reportUnique(rowId, title) {
            let string = '';
            string += '<div class="area">';
            string += '<h5><strong>' + title + ' на участке ' + rowId + ':</strong></h5>';
            string += 'R = ' + schemaObj.templates[rowId][0].valueItem + ' мОм;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            string += 'X = ' + schemaObj.templates[rowId][1].valueItem + ' мОм;<br>';
            string += 'R<sub>0</sub> = ' + schemaObj.templates[rowId][2].valueItem + ' мОм;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            string += 'X<sub>0</sub> = ' + schemaObj.templates[rowId][3].valueItem + ' мОм.<br>';
            string += '</div>';
            return string;
        }

        function reportCalcKz() {
            let string = '';
            for (let kzIdkey in schemaObj.kzId) {
                string += '<div class="area">';
                string += '<div class="area-result"><h3>Расчет для КЗ на участке ' + kzIdkey + ':</h3>';
                string += '<h5><i>Суммарное сопротивление цепи</i>:</h5>';
                let i = 0;
                let formulaR = '';
                let formulaX = '';
                let formulaR0 = '';
                let formulaX0 = '';
                let valuesR = '';
                let valuesX = '';
                let valuesR0 = '';
                let valuesX0 = '';
                let R = 0;
                let X = 0;
                let R0 = 0;
                let X0 = 0;
                let pls = ' + ';
                for (let rowId in schemaObj.resistance) {
                    if (schemaObj.resistance[rowId].r !== 0) {
                        formulaR += 'R<sub>' + symbol[schemaObj.elements[rowId].key] + '</sub>' + pls;
                        valuesR += customRound(schemaObj.resistance[rowId].r) + pls;
                        R += schemaObj.resistance[rowId].r;
                    }
                    if (schemaObj.resistance[rowId].x !== 0) {
                        formulaX += 'X<sub>' + symbol[schemaObj.elements[rowId].key] + '</sub>' + pls;
                        valuesX += customRound(schemaObj.resistance[rowId].x) + pls;
                        X += schemaObj.resistance[rowId].x;
                    }
                    if (schemaObj.resistance[rowId].r0 !== 0) {
                        formulaR0 += 'R<sub>0' + symbol[schemaObj.elements[rowId].key] + '</sub>' + pls;
                        valuesR0 += customRound(schemaObj.resistance[rowId].r0) + pls;
                        R0 += schemaObj.resistance[rowId].r0;
                    }
                    if (schemaObj.resistance[rowId].x0 !== 0) {
                        formulaX0 += 'X<sub>0' + symbol[schemaObj.elements[rowId].key] + '</sub>' + pls;
                        valuesX0 += customRound(schemaObj.resistance[rowId].x0) + pls;
                        X0 += schemaObj.resistance[rowId].x0;
                    }
                    if (kzIdkey == rowId) break;
                    ++i;
                }
                string += 'R<sub>&sum;</sub> = ' + formulaR.replace(/\+ $/g, '') + ' = ' + valuesR.replace(/\+ $/g, '') + ' = ' + customRound(R) + ' мОм;<br>';
                string += 'X<sub>&sum;</sub> = ' + formulaX.replace(/\+ $/g, '') + ' = ' + valuesX.replace(/\+ $/g, '') + ' = ' + customRound(X) + ' мОм;<br>';
                string += 'R<sub>0&sum;</sub> = ' + formulaR0.replace(/\+ $/g, '') + ' = ' + valuesR0.replace(/\+ $/g, '') + ' = ' + customRound(R0) + ' мОм;<br>';
                string += 'X<sub>0&sum;</sub> = ' + formulaX0.replace(/\+ $/g, '') + ' = ' + valuesX0.replace(/\+ $/g, '') + ' = ' + customRound(X0) + ' мОм.<br>';
                let arcResistance = schemaObj.defaultVar.arcResistance * 1;
                let rSumAccent = customRound(R) + arcResistance;
                string += 'R<sub>&sum;</sub>&prime; = R<sub>&sum;</sub> + R<sub>д</sub>  = ' + customRound(R) + ' + ' + arcResistance + ' = ' + rSumAccent + ' мОм;<br>';
                let ik3max = customRound((schemaObj.defaultVar.unn * 1000) / (Math.sqrt(3) * Math.sqrt(Math.pow(X, 2) + Math.pow(R, 2))));
                let ik3min = customRound((schemaObj.defaultVar.unn * 1000) / (Math.sqrt(3) * Math.sqrt(Math.pow(X, 2) + Math.pow(R + arcResistance, 2))));
                let ikudmax = customRound(Math.sqrt(2) * ik3max * koefUd(R, X));
                let ikudmin = customRound(Math.sqrt(2) * ik3min * koefUd(R + arcResistance, X));
                let ika0max = customRound(Math.sqrt(2) * ik3max);
                let ika0min = customRound(Math.sqrt(2) * ik3min);
                let ik2max = customRound((schemaObj.defaultVar.unn * 1000) / (2 * Math.sqrt(Math.pow(X, 2) + Math.pow(R, 2))));
                let ik2min = customRound((schemaObj.defaultVar.unn * 1000) / (2 * Math.sqrt(Math.pow(X, 2) + Math.pow(R + arcResistance / 2, 2))));
                let ik1max = customRound((schemaObj.defaultVar.unn * 1000 * Math.sqrt(3)) / Math.sqrt(Math.pow((2 * X) + X0, 2) + Math.pow((2 * R) + R0, 2)));
                let ik1min = customRound((schemaObj.defaultVar.unn * 1000 * Math.sqrt(3)) / Math.sqrt(Math.pow((2 * X) + X0, 2) + Math.pow((2 * (R + arcResistance)) + (R0 + arcResistance), 2)));
                string += '<h5><i>Максимальное значение трехфазного тока КЗ</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width: 590px;"><tr><td rowspan="2">I<sub>к.max</sub><sup>(3)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2">&nbsp;=&nbsp;' + ik3max + ' кА;</td></tr><tr><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">R<sub>&sum;</sub><sup>2</sup> + X<sub>&sum;</sub><sup>2</sup></div></td><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">' + customRound(R) + '<sup>2</sup> + ' + customRound(X) + '<sup>2</sup></div></td></tr></table><br></div>';
                string += '<h5><i>Минимальное значение трехфазного тока КЗ (с учетом сопротивления дуги)</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width: 590px;"><tr><td rowspan="2">I<sub>к.min</sub><sup>(3)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2">&nbsp;=&nbsp;' + ik3min + ' кА;</td></tr><tr><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(R<sub>&sum;</sub> + R<sub>д</sub>)<sup>2</sup> + X<sub>&sum;</sub><sup>2</sup></div></td><td style="border-top: 1px solid #000;"> &radic;<span style="text-decoration:overline;">3</span> &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(' + customRound(R) + ' + ' + schemaObj.defaultVar.arcResistance + ')<sup>2</sup> + ' + customRound(X) + '<sup>2</sup></div></td></tr></table><br></div>';
                string += '<p>R<sub>д</sub> - <i>сопротивление дуги, мОм</i></p>';
                string += '<h5><i>Наибольшее начальное значение апериодической составляющей тока КЗ</i>:</h5>';
                string += 'i<sub>а0.max</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; I<sub>к.max</sub><sup>(3)</sup> = &radic;<span style="text-decoration:overline;">2</span> &times; ' + ik3max + ' = ' + ika0max + ' кА;<br>';
                string += 'i<sub>а0.min</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; I<sub>к.min</sub><sup>(3)</sup> = &radic;<span style="text-decoration:overline;">2</span> &times; ' + ik3min + ' = ' + ika0min + ' кА;<br>';
                string += '<h5><i>Значение ударного тока КЗ</i>:</h5>';
                string += 'i<sub>уд.max</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; I<sub>к.max</sub><sup>(3)</sup> &times; K<sub>уд</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; ' + ik3max + ' &times; ' + koefUd(R, X) + ' = ' + ikudmax + ' кА;<br>';
                string += 'i<sub>уд.min</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; I<sub>к.min</sub><sup>(3)</sup> &times; K<sub>уд</sub> = &radic;<span style="text-decoration:overline;">2</span> &times; ' + ik3min + ' &times; ' + koefUd(R + arcResistance, X) + ' = ' + ikudmin + ' кА;<br>';
                string += 'K<sub>уд</sub> - <i>Ударный коэффициент (см. кривые зависимости ударного коэффициента от отношений R/X и X/R).</i></p>';
                string += '<h5><i>Максимальное значение двухфазного тока КЗ</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width: 540px;"><tr><td rowspan="2">I<sub>к.max</sub><sup>(2)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2">&nbsp;=&nbsp;' + ik2max + ' кА;</td></tr><tr><td style="border-top: 1px solid #000;"> 2 &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">R<sub>&sum;</sub><sup>2</sup> + X<sub>&sum;</sub><sup>2</sup></div></td><td style="border-top: 1px solid #000;"> 2 &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">' + customRound(R) + '<sup>2</sup> + ' + customRound(X) + '<sup>2</sup></div></td></tr></table><br></div>';
                string += '<h5><i>Минимальное значение двухфазного тока КЗ (с учетом сопротивления дуги)</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width: 590px;"><tr><td rowspan="2">I<sub>к.min</sub><sup>(2)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2">&nbsp;=&nbsp;</td><td style="text-align:center;">' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2">&nbsp;=&nbsp;' + ik2min + ' кА;</td></tr><tr><td style="border-top: 1px solid #000;"> 2 &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(R<sub>&sum;</sub> + R<sub>д</sub>/2)<sup>2</sup> + X<sub>&sum;</sub><sup>2</sup></div></td><td style="border-top: 1px solid #000;"> 2 &times; &radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(' + customRound(R) + ' + ' + schemaObj.defaultVar.arcResistance + '/2)<sup>2</sup> + ' + customRound(X) + '<sup>2</sup></div></td></tr></table><br></div>';
                string += '<h5><i>Максимальное значение однофазного тока КЗ</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width:350px;"><tr><td rowspan="2">I<sub>к.max</sub><sup>(1)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">&radic;<span style="text-decoration:overline;">3</span> &times; U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2"> ;</td></tr><tr><td style="border-top: 1px solid #000;">&radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(2&timesR<sub>&sum;</sub> + R<sub>0&sum;</sub>)<sup>2</sup> + (2&timesX<sub>&sum;</sub> + X<sub>0&sum;</sub>)<sup>2</sup></div></td></tr></table><br></div>';
                string += '<div class="table-responsive"><table style="min-width: 550px;"><tr><td rowspan="2">I<sub>к.max</sub><sup>(1)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">&radic;<span style="text-decoration:overline;">3</span> &times; ' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2"> = ' + ik1max + ' кА.</td></tr><tr><td style="border-top: 1px solid #000;">&radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(2&times' + customRound(R) + ' + ' + customRound(R0) + ')<sup>2</sup> + (2&times' + customRound(X) + ' + ' + customRound(X0) + ')<sup>2</sup></div></td></tr></table></div>';
                string += '<h5><i>Минимальное значение однофазного тока КЗ (с учетом сопротивления дуги)</i>:</h5>';
                string += '<div class="table-responsive"><table style="min-width:400px;"><tr><td rowspan="2">I<sub>к.min</sub><sup>(1)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">&radic;<span style="text-decoration:overline;">3</span> &times; U<sub>нн</sub> &times; 10<sup>3</sup></td><td rowspan="2"> ;</td></tr><tr><td style="border-top: 1px solid #000;">&radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(2&times(R<sub>&sum;</sub> + R<sub>д</sub>) + R<sub>0&sum;</sub> + R<sub>д</sub>)<sup>2</sup> + (2&timesX<sub>&sum;</sub> + X<sub>0&sum;</sub>)<sup>2</sup></div></td></tr></table><br></div>';
                string += '<div class="table-responsive"><table style="min-width: 590px;"><tr><td rowspan="2">I<sub>к.min</sub><sup>(1)</sup>&nbsp;=&nbsp;</td><td style="text-align:center;">&radic;<span style="text-decoration:overline;">3</span> &times; ' + schemaObj.defaultVar.unn + ' &times; 1000</td><td rowspan="2"> = ' + ik1min + ' кА.</td></tr><tr><td style="border-top: 1px solid #000;">&radic;<div style="border-top:1px solid #000;display:inline-block;margin-top:2px;">(2&times(' + customRound(R) + ' + ' + schemaObj.defaultVar.arcResistance + ') + ' + customRound(R0) + ' + ' + schemaObj.defaultVar.arcResistance + ')<sup>2</sup> + (2&times' + customRound(X) + ' + ' + customRound(X0) + ')<sup>2</sup></div></td></tr></table></div>';
                string += '</div></div>';
            }
            return string;
        }

        function reportSchema() {
            let string = '';
            for (let rowId in schemaObj.elements) {
                let title = '';
                if (schemaObj.elements[rowId].title !== null) {
                    title = schemaObj.elements[rowId].title;
                } else {
                    title = schemaObj.elements[rowId].name;
                }
                if (schemaObj.templates[rowId][0].textItem !== null) {
                    title += '<br>' + schemaObj.templates[rowId][0].textItem;
                }
                string += '<div class="row">';
                string += '<div class="col-xs-6">';
                string += '<div class="reportTitle"><span><strong> ' + rowId + ') </strong></span><span> ' + title + ' </span></div>';
                string += '</div>';
                string += '<div class="col-xs-6">';
                let img;
                if (schemaObj.elements[rowId].key == 'energySystem') {
                    img = reportSysSvg;
                } else if (schemaObj.elements[rowId].key == 'hookup') {
                    img = reportRSvg;
                } else {
                    img = reportRxSvg;
                }
                let pointKz = '';
                let pointKzImg = '';
                if (schemaObj.elements[rowId].pointKz !== null) {
                    pointKz = ' pointKz';
                    pointKzImg = '<span>К' + rowId + '</span> ' + pointKzSvg;
                }
                string += '<div class="' + schemaObj.elements[rowId].key + 'Img' + pointKz + '">';
                string += '   <div class="resistanceData">' + addResistance(rowId, true) + '</div>';
                string += '   <div id="pointKzWrapper' + rowId + '" class="pointKzWrapper">' + pointKzImg + '</div>';
                string += img;
                string += '</div>';
                string += '</div>';
                string += '</div>';
            }
            string += '<div class="row">';
            string += '<div class="col-xs-12 img-responsive">';
            string += '<br><br><h4>Кривые зависимости ударного коэффициента от отношений R/X и X/R</h4>';
            string += koefRXSvg;
            string += '</div>';
            string += '<div class="col-xs-12 img-responsive"><br>';
            string += koefXRSvg;
            string += '</div>';
            string += '</div>';
            return string;
        }

        function report() {
            let error = [];
            let string = '';
            if (isEmptyObject(schemaObj.elements) !== 0) {
                string += '<div class="row">';
                string += '<h3>Расчет токов КЗ 0,4кВ (ГОСТ 28249-93)</h3><br>';
                string += '<div class="col-md-5">';
                string += reportSchema();
                string += '</div>';
                string += '<div class="col-md-7">';
                string += '<div class="area">R - <i>активное сопротивление прямой последовательности;</i><br>X - <i>индуктивное сопротивление прямой последовательности;</i><br>R<sub>0</sub> - <i>активное сопротивление обратной последовательности;</i><br>X<sub>0</sub> - <i>индуктивное сопротивление обратной последовательности;</i></div>';
                for (rowId in schemaObj.elements) {
                    let title = '';
                    if (schemaObj.elements[rowId].title !== null) {
                        title = schemaObj.elements[rowId].title;
                    } else {
                        title = schemaObj.elements[rowId].name;
                    }
                    if (schemaObj.elements[rowId].key == 'energySystem') {
                        string += reportEnergySystem(rowId);
                    } else if (schemaObj.elements[rowId].key == 'transformator') {
                        string += reportTransformator(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'kabelVn') {
                        string += reportKabelVn(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'kabelNn') {
                        string += reportKabelNn(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'shinoprovod') {
                        string += reportShinoprovod(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'hookup') { //контакты
                        string += reportHookup(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'tt') {
                        string += reportTt(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'avtomat') {
                        string += reportAvtomat(rowId, title);
                    } else if (schemaObj.elements[rowId].key == 'unique') {
                        string += reportUnique(rowId, title);
                    }
                    if (schemaObj.resistance[rowId].r === null || schemaObj.resistance[rowId].x === null || !isFinite(schemaObj.resistance[rowId].r) || !isFinite(schemaObj.resistance[rowId].x) || (schemaObj.resistance[rowId].r == 0 && schemaObj.resistance[rowId].x == 0 && schemaObj.resistance[rowId].r0 == 0 && schemaObj.resistance[rowId].x0 == 0)) {
                        error.push(rowId);
                    }
                }
                string += reportCalcKz();
                string += '</div>';
                string += '</div>';
                if (isEmptyObject(schemaObj.kzId) === 0) {
                    customModal(textAddPointKz);
                } else {
                    if (error.length > 0) {
                        customModal(textResistanceIsNotDefined, error.join(', '));

                    } else {
                        result(string);
                    }
                }
            } else {
                customModal(textAddEl);
            }
        }

        function koefUd(r, x) {
            let rx = r / x;
            let xr = x / r;
            let koef, krx, kxr;
            for (let rxKey in koefUdRX) {
                let koefRX = koefUdRX[rxKey];
                rxKey = +rxKey;
                krx = koefRX;
                if (rxKey > rx) {
                    break;
                }
            }
            for (let xrKey in koefUdXR) {
                let koefXR = koefUdXR[xrKey];
                xrKey = +xrKey;
                kxr = koefXR;
                if (xrKey > xr) {
                    break;
                }
            }
            koef = Math.max(krx, kxr);
            return koef;
        }

        function result(data) {
            let string = '';
            let resultBlock = document.getElementById('projectResult');
            let setBlock = document.getElementById('projectSet');
            string += '<button type="button" id="report-close" class="close hidden-print"><span>&times;</span></button>';
            string += '<div class="container">';
            string += data;
            string += '</div>';
            string += '</div>';
            setBlock.style.display = 'none';
            resultBlock.innerHTML = string;
            window.scrollTo(0, 0);
            let close = document.getElementById("report-close");
            close.onclick = function () {
                resultBlock.innerHTML = '';
                setBlock.style.display = 'block';
            }
        }

        function saveLocalScheme() {
            let html = '';
            let name = '';
            let data;
            html += '<div class="form-group"><label><i>Введите название проекта</i></label>';
            html += '<input name="projectName" class="form-control" id="projectName" type="text" value="">';
            html += '</div>';
            html += '<span id="saveProject" class="btn btn-success">Сохранить</span>';
            customModal(html);
            let elName = document.getElementById("projectName");
            let elSave = document.getElementById("saveProject");
            name = projectName.addEventListener("change", function () {
                name = elName.value;
                return name;
            });

            elSave.addEventListener("click", function () {
                try {
                    let projectsId = localStorage.getItem('projectsId');
                    if (projectsId === null) {
                        projectsId = [];
                    }
                    else {
                        projectsId = JSON.parse(projectsId);
                    }
                    if (name === undefined) {
                        name = 'Проект ';
                    } else {
                        name = name.replace(/[\\\|\'\"\#^\:\;\\$\%\&\?\/]/g, '');
                    }
                    let date = getDate();
                    let id = date.replace(/[.: ]/g, '');
                    let str = id + '|' + name + '|' + date;
                    let max = 20;
                    if (projectsId.length > max) {
                        let del = projectsId.shift();
                        let delId = del.split('|');
                        localStorage.removeItem(delId[0]);
                    }
                    projectsId.push(str);
                    localStorage.setItem(id, JSON.stringify(schemaObj));
                    localStorage.setItem('projectsId', JSON.stringify(projectsId));
                    customModal(textProjectSaved);
                } catch (err) {
                    customModal(textLocalError);
                }
            });
        }

        function loadLocalScheme() {
            let html = '';
            let projectsId;
            try {
                projectsId = localStorage.getItem('projectsId');
                let id;
                if (projectsId == null) {
                    customModal(textDontHaveSavProject);
                } else {
                    projectsId = JSON.parse(projectsId);

                    html = '<div class="form-group"><label><i>Выберите проект</i></label>';
                    html += '<select id="projectSelect" class="form-control" name="projectSelect">';
                    html += " <option value=''>--- Сделайте выбор ---</option>";
                    for (let i = 0; i < projectsId.length; i++) {
                        let projectsIdArray = projectsId[i].split('|');
                        html += "<option value='" + projectsIdArray[0] + "'>" + projectsIdArray[1] + "  -  " + projectsIdArray[2] + "</option>";
                    }
                    html += '</select>';
                    html += '</div>';
                    html += '<span id="loadProject" class="btn btn-success">Загрузить</span>';
                    customModal(html);
                    let elSelect = document.getElementById("projectSelect");
                    let elLoad = document.getElementById("loadProject");
                    id = elSelect.addEventListener("change", function () {
                        id = elSelect.value;
                        return id;
                    });
                    elLoad.addEventListener("click", function () {
                        let projectId = localStorage.getItem(id);
                        if (projectId !== null) {
                            renderScheme(projectId);
                        }
                    });
                }
            } catch (err) {
                customModal(textLocalError);
            }
        }

        function saveFileScheme() {
            let html = '';
            let name = '';
            let data;
            html += '<div class="form-group"><label><i>Введите название проекта</i></label>';
            html += '<input name="projectName" class="form-control" id="projectName" type="text" value="">';
            html += '</div>';
            html += '<a href="javascript:void(0)" id="saveProject" class="btn btn-success">Сохранить</a>';
            customModal(html);
            let elName = document.getElementById("projectName");
            let elSave = document.getElementById("saveProject");
            name = projectName.addEventListener("change", function () {
                name = elName.value;
                return name;
            });

            elSave.addEventListener("click", function () {
                try {
                    let project = JSON.stringify(schemaObj);
                    if (name === undefined) {
                        name = 'Проект ';
                    } else {
                        name = name.replace(/[\\\|\'\"\#^\:\;\\$\%\&\?\/]/g, '');
                    }
                    let type = 'text/plain';
                    let date = getDate();
                    let id = date.replace(/[: ]/g, '_');
                    name = name + id + '.txt';
                    let file = new Blob([project], {type: type});
                    if (window.navigator.msSaveOrOpenBlob) // IE10+
                        window.navigator.msSaveOrOpenBlob(file, name);
                    else {
                        elSave.href = URL.createObjectURL(file);
                        elSave.download = name;
                    }
                    customModal(textProjectSendSaved);
                } catch (err) {
                    customModal(textSaveFileError);
                }
            });
        }

        function loadFileScheme() {
            let html = '';
            html += '<div class="form-group">';
            html += '<label for="loadFile">Выберите файл проекта</label>';
            html += '<input type="file" id="loadFile" name="loadFile" />';
            html += '<div id="importDataBlock"></div>';
            html += '<div id="dataFileBlock"></div>';
            html += '</div>';
            customModal(html);
            let loadFileId = document.getElementById('loadFile');
            let dataFileBlock = document.getElementById('dataFileBlock');
            loadFileId.addEventListener('change', function (evt) {
                let files = evt.target.files;
                let file = files[0];
                let reader = new FileReader();
                reader.onload = function (theFile) {
                    dataFileBlock.innerHTML = theFile.target.result;
                    document.getElementById('importDataBlock').innerHTML = '<span id="importData" class="btn btn-primary mt1" onclick="importDataInFile()">Импортировать проект</span>';
                }
                reader.readAsText(file);
            });
        }

        function importDataInFile() {
            let dataFileBlock = document.getElementById('dataFileBlock').innerHTML;
            let data = JSON.parse(dataFileBlock);
            //schemaObj = data;
            renderScheme(JSON.stringify(data)); 
        }

        function renderScheme(loadedObject) {
            let tbody = document.getElementById('dynamic');
            let arcSelectVar = document.getElementById("arcSelect");
            let arcInputVar = document.getElementById("arcInput");
            let html = '';
            if (loadedObject !== null) {
                schemaObj = JSON.parse(loadedObject);
                arcInputVar.value = schemaObj.defaultVar.arcResistance;
                arcSelectVar.innerHTML = addOption(arcArray, schemaObj.defaultVar.arcResistance);
                for (rowId in schemaObj.elements) {
                    let title;
                    if (schemaObj.elements[rowId].title !== null) {
                        title = schemaObj.elements[rowId].title;
                    } else {
                        title = schemaObj.elements[rowId].name;
                    }
                    html += "<tr id=\"row" + rowId + "\">";
                    html += "   <td id=\"elementSelect" + rowId + "\">";
                    html += "       <div class=\"form-inline\">";
                    html += "           <div class=\"form-group\"><label>" + rowId + "</label>&nbsp;";
                    html += "               <input id=\"elementSelectVal" + rowId + "\" class=\"form-control select\" type=\"text\" name=\"elementSelectVal[" + rowId + "]\" onchange=\"changeElementTitleValue(this.id," + rowId + ")\" value=\"" + title + "\">";
                    html += "           </div>";
                    html += "       </div>";
                    html += "   </td>";
                    html += "   <td id=\"elementScheme" + rowId + "\" class=\"elementScheme\">" + renderItemScheme(schemaObj.elements[rowId].key, rowId, addResistance(rowId, true)) + "</td>";
                    html += "   <td id=\"elementData" + rowId + "\" class=\"elementData\">" + htmlDecode(renderTemplateItemData(schemaObj.elements[rowId].key, rowId, true)) + "</td>";
                    html += "   <td id=\"pointKz" + rowId + "\" class=\"elementPointKz\">" + renderItemPointKz(schemaObj.elements[rowId].key, rowId, schemaObj.elements[rowId].pointKz) + "</td>";
                    html += "   <td><input type=\"button\" value=\"Удалить\" class=\"delete btn btn-danger\" onclick=\"deleteRow(" + rowId + ")\"></td>";
                    html += "</tr>";

                }
                html += "<tr class=\"table-row\"><td class=\"selector\"><select id=\"elementSelect\" class=\"form-control\" name=\"elementSelect\">";
                html += addElementsSelect();
                html += "</select></td><td class=\"elementScheme\"></td><td class=\"elementData\"></td><td class=\"elementPointKz\"></td><td class=\"rowAddDel\"><input type=\"button\" class=\"add btn btn-success\" onclick=\"addRow(schemaObj);\" value=\"Добавить\"></td></tr>";
            }
            tbody.innerHTML = html;
        }

        function customRound(num, digit) {
            if (digit === undefined) {
                digit = 3;
            }
            let res = +parseFloat(num).toFixed(digit);
            return res;
        }

        function getDate() {
            let date = new Date();
            let dd = date.getDate();
            let mm = date.getMonth() + 1; //January is 0!
            let yyyy = date.getFullYear();
            let h = date.getHours();
            let m = date.getMinutes();
            let s = date.getSeconds();
            let ms = date.getMilliseconds();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            let today = dd + '.' + mm + '.' + yyyy + ' ' + h + ':' + m + ':' + s;
            let key = dd + mm + yyyy + h + m + s + ms;
            return today;
        }

        function htmlDecode(str) {
            let result = str.replace(/&gt;/g, '>');
            result = result.replace(/&lt;/g, '<');
            //result = result.replace(/&quot;/g, '"');
            //result = result.replace(/&apos;/g, "'");
            //result = result.replace(/&amp;/g, '&');
            return result;
        };

        function htmlEncode(str) {
            let result = str.replace(/>/g, '&gt;');
            result = result.replace(/</g, '&lt;');
            //result = result.replace(/"/g, '&quot;');
            //result = result.replace(/'/g, "&apos;");
            //result = result.replace(/&/g, '&amp;');
            return result;
        };

        function iterationCopy(src) {
            let target = {};
            for (let prop in src) {
                if (src.hasOwnProperty(prop)) {
                    target[prop] = src[prop];
                }
            }
            return target;
        }

        function changeElementComplex(elementId, rowId) { 
            schemaObj.resistanceStatus[rowId] = false; 
            schemaObj.resistance[rowId] = {current: null, bazis: null, EngRel: null, Z1ngRel: null, Z2ngRel: null, Z0ngRel: null, Eng: null, Z1ng: null, Z2ng: null, Z0ng: null};
            let elSelect = document.getElementById(elementId);
            let elSelectValue = elSelect.value;
            if (elSelectValue == '') {
                document.getElementById("complex-data").innerHTML = '';
                addResistance(rowId);
            } else {
                renderTemplComplex(elSelectValue, rowId);
                changeElementValue(elementId, rowId);
            }
        }

        function renderTemplComplex(elSelectValue, rowId) {
            schemaObj.templates[rowId].length = complexTemplate.length;
            let html = '';
            let titleArray = elSelectValue.split('_');
            for (let i = 0; i < titleArray.length; i++) {
                let complexTemplateLoc = {
                    typeItem: 'input',
                    idItem: titleArray[i] + "_" + rowId,
                    classItem: 'form-control w1',
                    valueItem: '',
                    textItem: null,
                    labelItem: htmlEncode('<i>' + complexTitle[titleArray[i]] + '</i> = '),
                    functionItem: 'changeElementValue',
                    wrapperItemStart: htmlEncode('<div class=\"form-group\">'),
                    wrapperItemEnd: htmlEncode('</div>'),
                    suffixItem: 'кВт',
                    outerData: null
                }
                schemaObj.templates[rowId].push(complexTemplateLoc);
                html += "   <div class=\"form-group\"><label for=\"" + titleArray[i] + rowId + "\"><i>" + complexTitle[titleArray[i]] + " </i> =&nbsp;</label>";
                html += "       <input id=\"" + titleArray[i] + "_" + rowId + "\" onchange=\"changeElementValue(this.id, " + rowId + ")\" class=\"form-control w1\" type=\"text\" data-templatearraykey=\"" + (i + complexTemplate.length) + "\" name=\"" + titleArray[i] + rowId + "\" value=\"\"> кВт";
                html += "   </div>";
            } 
            document.getElementById("complex-data").innerHTML = html;    
        }

    </script>
</head>

<body id="body">
<div id="modal" class="modal fade">
    <div class="modal-dialog">
        <div id="modal-content" class="modal-content">
            <div class="modal-header">
                <button type="button" id="modal-close" class="close"><span>&times;</span></button>
            </div>
            <div id="modal-body" class="modal-body">
            </div>
        </div>
    </div>
</div>
<nav class="navbar navbar-default navbar-static-top navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-left">
            <span id="calcCurrentKz" onclick="tokKz();" class="btn btn-primary navbar-btn">Расчитать ток КЗ</span>
            <span id="reportCurrentKz" onclick="report();" class="btn btn-success"><i><svg
                    xmlns="http://www.w3.org/2000/svg" width="10.69" height="15" viewBox="0 0 10.69 15"><polygon
                    points="6.96 0.5 0.5 0.5 0.5 14.5 10.19 14.5 10.19 3.73 6.96 0.5" fill="none" stroke="#fff"
                    stroke-miterlimit="10"/><polyline points="10.19 3.73 6.96 3.73 6.96 0.5 6.96 3.73" fill="none"
                    stroke="#fff" stroke-miterlimit="10"/><line x1="2.12" y1="5.88"
                    x2="8.58" y2="5.88"
                    fill="none"
                    stroke="#fff"
                    stroke-miterlimit="10"/><line
                    x1="2.12" y1="8.04" x2="8.58" y2="8.04" fill="none" stroke="#fff" stroke-miterlimit="10"/><line
                    x1="2.12" y1="10.19" x2="8.58" y2="10.19" fill="none" stroke="#fff" stroke-miterlimit="10"/><line
                    x1="2.12" y1="12.35" x2="6.42" y2="12.35" fill="none" stroke="#fff"
                    stroke-miterlimit="10"/></svg></i> Показать расчет</span></div>
        <div class="navbar-right"></div>
        <div class="navbar-right">
            <span id="saveFileScheme" onclick="saveFileScheme();" class="btn btn-default navbar-btn"><i><svg
                    xmlns="http://www.w3.org/2000/svg" width="13.8" height="14.04"><path fill="#010002"
                    d="M10.78 0H3.19L0 2.85v11.19h7.59v-1H1.13V3.95H4.4V1h5.24v3.11h1.14V0z"/><path
                    d="M13.78 10.13a.19.19 0 0 0-.17-.12h-2.07V5.44a.18.18 0 0 0-.19-.18h-3a.18.18 0 0 0-.19.18V10H6.08a.2.2 0 0 0-.18.12.19.19 0 0 0 0 .2L9.7 14a.24.24 0 0 0 .14 0 .21.21 0 0 0 .16 0l3.77-3.66a.19.19 0 0 0 .01-.21z"/></svg></i> Сохранить проект в файл</span>
            <span id="loadFileScheme" onclick="loadFileScheme();" class="btn btn-default navbar-btn"><i><svg
                    xmlns="http://www.w3.org/2000/svg" width="13.8" height="14.04"><path fill="#010002"
                    d="M10.78 0H3.19L0 2.85v11.19h7.59v-1H1.13V3.95H4.4V1h5.24v3.11h1.14V0z"/><path
                    d="M5.9 9.17a.19.19 0 0 0 .18.11h2.06v4.58a.19.19 0 0 0 .19.18h3a.18.18 0 0 0 .18-.18V9.28h2.08a.18.18 0 0 0 .15-.28L10 5.31a.19.19 0 0 0-.13 0 .24.24 0 0 0-.14 0L5.94 9a.18.18 0 0 0-.04.17z"/></svg></i> Загрузить проект из файла</span>
            <span id="saveLocalScheme" onclick="saveLocalScheme();" class="btn btn-default navbar-btn"><i><svg
                    xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14"><path
                    d="M3.5,12.83h7V9.33h-7Zm8.17,0h1.17V4.67a1,1,0,0,0-.09-.35A1,1,0,0,0,12.56,4L10,1.44a1,1,0,0,0-.31-.18,1,1,0,0,0-.36-.09V5a.87.87,0,0,1-.87.88H3.21A.87.87,0,0,1,2.33,5V1.17H1.17V12.83H2.33V9a.87.87,0,0,1,.88-.87h7.58a.87.87,0,0,1,.88.88ZM8.17,4.38V1.46a.3.3,0,0,0-.29-.29H6.13a.3.3,0,0,0-.29.29V4.38a.3.3,0,0,0,.29.29H7.88a.3.3,0,0,0,.29-.29ZM14,4.67v8.46a.87.87,0,0,1-.87.88H.88a.84.84,0,0,1-.62-.26A.84.84,0,0,1,0,13.13V.88A.84.84,0,0,1,.26.26.84.84,0,0,1,.88,0H9.33a2.1,2.1,0,0,1,.8.18,2.12,2.12,0,0,1,.69.44l2.55,2.55a2.12,2.12,0,0,1,.44.69A2.1,2.1,0,0,1,14,4.67Z"/></svg></i> Сохранить проект</span>
            <span id="loadLocalScheme" onclick="loadLocalScheme();" class="btn btn-default navbar-btn"><i><svg
                    xmlns="http://www.w3.org/2000/svg" width="18.6" height="14" viewBox="0 0 18.6 14"><path
                    d="M14,4.67a4.67,4.67,0,1,0-9.33,0A4.67,4.67,0,0,0,0,9.49,4.81,4.81,0,0,0,4.9,14H7a.73.73,0,0,0,.78-.78V10.89H6.85A.78.78,0,0,1,6.3,9.57L8.79,7.08a.75.75,0,0,1,1.09,0l2.49,2.49a.78.78,0,0,1-.54,1.32h-.93v2.33a.73.73,0,0,0,.78.78h2.1a4.69,4.69,0,0,0,4.82-4.51A4.56,4.56,0,0,0,14,4.67Z"/></svg></i> Загрузить проект</span>
        </div>

    </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div id="projectResult">
            </div>
            <div id="projectSet">
                <h1 class="h3">Программа расчета токов КЗ 0,4кВ (ГОСТ 28249-93)</h1>
                <form method="post" action="" id="formKz">
                    <div class="form-inline mb1">
                        <div class="form-group">
                            <label><i>Выбор сопротивления дуги </i></label>
                            <select id="arcSelect" class="form-control" name="arcSelect">
                            </select>
                        </div>
                        <div class="form-group">
                            <input name="arcInput" class="form-control w1" id="arcInput" type="text" value=""
                                    autocomplete="off"> мОм
                        </div>
                    </div>
                    <table id="tableKz" class="table">
                        <thead>
                        <tr>
                            <th class="td-element">Элемент</th>
                            <th class="td-element-elementScheme">Схема</th>
                            <th>Данные</th>
                            <th class="elementPointKz">Точка КЗ</th>
                            <th class="rowAddDel">&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody id="dynamic">
                        <tr class="table-row">
                            <td class="selector">
                                <select id="elementSelect" class="form-control w2" name="elementSelect">
                                </select>
                            </td>
                            <td class="elementScheme">

                            </td>
                            <td class="elementData">

                            </td>
                            <td class="elementPointKz">

                            </td>
                            <td class="rowAddDel">
                                <input type="button" class="add btn btn-success" onclick="addRow();"
                                        value="Добавить">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>
